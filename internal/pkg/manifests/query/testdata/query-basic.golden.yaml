- apiVersion: v1
  automountServiceAccountToken: true
  kind: ServiceAccount
  metadata:
    labels:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query-test-owner
      app.kubernetes.io/managed-by: thanos-operator
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: thanos
      operator.thanos.io/owner: test-owner
      operator.thanos.io/query-api: "true"
    name: thanos-query-test-owner
    namespace: test-namespace
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    labels:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query-test-owner
      app.kubernetes.io/managed-by: thanos-operator
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: thanos
      app.kubernetes.io/version: v0.40.1
      operator.thanos.io/owner: test-owner
      operator.thanos.io/query-api: "true"
    name: thanos-query-test-owner
    namespace: test-namespace
  spec:
    replicas: 0
    selector:
      matchLabels:
        app.kubernetes.io/component: query-layer
        app.kubernetes.io/instance: thanos-query-test-owner
        app.kubernetes.io/managed-by: thanos-operator
        app.kubernetes.io/name: thanos-query
        app.kubernetes.io/part-of: thanos
        operator.thanos.io/owner: test-owner
        operator.thanos.io/query-api: "true"
    strategy: {}
    template:
      metadata:
        labels:
          app.kubernetes.io/component: query-layer
          app.kubernetes.io/instance: thanos-query-test-owner
          app.kubernetes.io/managed-by: thanos-operator
          app.kubernetes.io/name: thanos-query
          app.kubernetes.io/part-of: thanos
          app.kubernetes.io/version: v0.40.1
          operator.thanos.io/owner: test-owner
          operator.thanos.io/query-api: "true"
      spec:
        affinity:
          podAntiAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
            - podAffinityTerm:
                labelSelector:
                  matchExpressions:
                  - key: app.kubernetes.io/name
                    operator: In
                    values:
                    - thanos-query-test-owner
                namespaces:
                - test-namespace
                topologyKey: kubernetes.io/hostname
              weight: 100
        containers:
        - args:
          - query
          - --log.level=info
          - --log.format=logfmt
          - --grpc-address=0.0.0.0:10901
          - --http-address=0.0.0.0:9090
          - --query.timeout=15m
          - --query.lookback-delta=5m
          - --query.auto-downsampling
          - --query.promql-engine=thanos
          - --query.max-concurrent=20
          image: quay.io/thanos/thanos:v0.40.1:v0.39.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            failureThreshold: 4
            httpGet:
              path: /-/healthy
              port: 9090
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 1
          name: thanos-query
          ports:
          - containerPort: 10901
            name: grpc
          - containerPort: 9090
            name: http
          readinessProbe:
            failureThreshold: 20
            httpGet:
              path: /-/ready
              port: 9090
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          resources: {}
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            runAsNonRoot: true
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: FallbackToLogsOnError
        securityContext: {}
        serviceAccountName: thanos-query-test-owner
  status: {}
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query-test-owner
      app.kubernetes.io/managed-by: thanos-operator
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: thanos
      app.kubernetes.io/version: v0.40.1
      operator.thanos.io/owner: test-owner
      operator.thanos.io/query-api: "true"
    name: thanos-query-test-owner
    namespace: test-namespace
  spec:
    clusterIP: None
    ports:
    - name: grpc
      port: 10901
      targetPort: 10901
    - name: http
      port: 9090
      targetPort: 9090
    selector:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query-test-owner
      app.kubernetes.io/managed-by: thanos-operator
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: thanos
      operator.thanos.io/owner: test-owner
      operator.thanos.io/query-api: "true"
  status:
    loadBalancer: {}
- apiVersion: policy/v1
  kind: PodDisruptionBudget
  metadata:
    labels:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query-test-owner
      app.kubernetes.io/managed-by: thanos-operator
      app.kubernetes.io/name: thanos-query
      app.kubernetes.io/part-of: thanos
      app.kubernetes.io/version: v0.40.1
      operator.thanos.io/owner: test-owner
      operator.thanos.io/query-api: "true"
    name: thanos-query-test-owner
    namespace: test-namespace
  spec:
    maxUnavailable: 1
    selector:
      matchLabels:
        app.kubernetes.io/component: query-layer
        app.kubernetes.io/instance: thanos-query-test-owner
        app.kubernetes.io/managed-by: thanos-operator
        app.kubernetes.io/name: thanos-query
        app.kubernetes.io/part-of: thanos
        operator.thanos.io/owner: test-owner
        operator.thanos.io/query-api: "true"
  status:
    currentHealthy: 0
    desiredHealthy: 0
    disruptionsAllowed: 0
    expectedPods: 0
